```
EMERGENCY VEHICLE GREENWAVE SYSTEM - VISUAL OVERVIEW
=====================================================

NETWORK TOPOLOGY
================

    J1          J2          J3          J4          J5
    O ----E1---[ğŸš¥]---E2---[ğŸš¥]---E3----O----E4---- O
               ğŸ“¡         ğŸ“¡
              RSU1       RSU2
               |           |
               +-----+-----+
                     |
           Emergency Coordinator
                     |
              RL Environment


NORMAL OPERATION (No Emergency)
================================

Time: t=0

    [Vehicle Flow]
    ğŸš— â†’ [ğŸš¥] â†’ ğŸš— â†’ [ğŸš¥] â†’ ğŸš—
         J2           J3

    RL Agent:
    1. Observe: Vehicle speeds, positions, queue lengths
    2. Decide: Which phase for each traffic light
    3. Reward: Based on traffic flow (+10 to -10)


EMERGENCY VEHICLE DETECTED
===========================

Time: t=10s - Ambulance spawns

    ğŸš‘ ----------300m------â†’ [ğŸš¥]
    emergency_1              J2
                             ğŸ“¡ RSU1
                             â†“
                    "ğŸš¨ EMERGENCY DETECTED!"
                             â†“
              Emergency Coordinator
                     â†“
        Analyze route: E1â†’E2â†’E3â†’E4
        Junctions ahead: [J2, J3]
                     â†“
        Create greenwave path


GREENWAVE CREATION
==================

Time: t=12s - RSU detects ambulance

    Route Analysis:
    ğŸš‘ is on E1
    â””â”€> Next: E2 (through J2)
    â””â”€> Then: E3 (through J3)
    â””â”€> Future: E4, E5...

    Greenwave Plan:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Traffic Lightâ”‚ Current â”‚ Target â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ J2          â”‚ Phase 0  â”‚ Phase 2 â”‚ â† Green for E1â†’E2
    â”‚ J3          â”‚ Phase 1  â”‚ Phase 1 â”‚ â† Green for E2â†’E3
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


GREENWAVE ACTIVE
================

Time: t=13s - Lights turn green

    ğŸš‘ â†’â†’â†’ [ğŸŸ¢] â†’â†’â†’ [ğŸŸ¢] â†’â†’â†’
           J2       J3
           ğŸ“¡       ğŸ“¡
         RSU1     RSU2
           â†“        â†“
     Detection  Detection
     "Clear!"   "Clear!"

    Other directions:
    ğŸš— â›” (Red)    ğŸš— â›” (Red)
       â†“              â†“
    Wait for      Wait for
    ambulance     ambulance


REWARD CALCULATION
==================

During Emergency (t=13s):

    Emergency Vehicle Metrics:
    â”œâ”€ Speed: 15 m/s (54 km/h) âœ“ Fast
    â”œâ”€ Waiting: 0 seconds âœ“ No delay
    â””â”€ Greenwave: Active âœ“ Coordinated

    Rewards:
    â”œâ”€ Speed bonus: +200 (HUGE - moving fast!)
    â”œâ”€ Greenwave bonus: +50 (Active coordination)
    â”œâ”€ Waiting penalty: 0 (No waiting)
    â””â”€ Total Emergency: +250

    Base Traffic (scaled down):
    â”œâ”€ Normal vehicles: +5 (moderate flow)
    â””â”€ Scaled (Ã—0.3): +1.5

    Queue Penalties:
    â”œâ”€ Side roads waiting: -10 (acceptable)
    â””â”€ Scaled (Ã—0.5): -5

    TOTAL REWARD: +250 + 1.5 - 5 = +246.5 âœ… EXCELLENT


BAD SCENARIO - Emergency Delayed
=================================

Time: t=20s - If lights were NOT coordinated:

    ğŸš‘ â›” [ğŸ”´] â† Stopped at red light!
           J2
           ğŸ“¡
         RSU1
           â†“
    "Emergency waiting!"

    Emergency Vehicle Metrics:
    â”œâ”€ Speed: 0 m/s âœ— Stopped
    â”œâ”€ Waiting: 8 seconds âœ— Delayed
    â””â”€ Greenwave: Inactive âœ— No coordination

    Rewards:
    â”œâ”€ Speed penalty: -150 (SEVERE - stopped!)
    â”œâ”€ Waiting penalty: -100 (SEVERE - delayed!)
    â”œâ”€ Greenwave bonus: 0 (Not active)
    â””â”€ Total Emergency: -250

    TOTAL REWARD: -250 âŒ TERRIBLE

    Learning Signal:
    Difference: +246.5 - (-250) = +496.5
    â†’ MASSIVE difference teaches agent:
      "Prioritize emergency vehicles!"


VEHICLE LIFECYCLE MANAGEMENT
=============================

Problem: Vehicles with short routes disappear, causing crashes

Solution: Track vehicle lifecycle

    Vehicle States:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Spawned   â”‚ â† Vehicle enters simulation
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Active    â”‚ â† Vehicle moving in network
    â”‚ (Tracked)   â”‚    â€¢ Added to all_seen_vehicles
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â€¢ Observable by RL agent
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Completed  â”‚ â† Vehicle reaches destination
    â”‚  (Removed)  â”‚    â€¢ Removed from active vehicles
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â€¢ Added to completed_vehicles
           â†“            â€¢ No longer observable
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â€¢ No crash! âœ“
    â”‚   Despawned â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Code:
    def get_observable_veh_ids():
        all_vehs = traci.vehicle.getIDList()
        
        # Track new vehicles
        for veh in all_vehs:
            if veh not in self.all_seen_vehicles:
                self.all_seen_vehicles.add(veh)
        
        # Detect completed vehicles
        current_set = set(all_vehs)
        newly_completed = self.all_seen_vehicles - current_set - self.completed_vehicles
        self.completed_vehicles.update(newly_completed)
        
        # Return only active vehicles
        return list(all_vehs)[:self.beta]


RSU DETECTION ZONES
===================

    RSU Coverage (300m radius):

                300m
           â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
              â–²
              â”‚         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—
         â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”    â•‘  Detection â•‘
         â”‚    â”‚    â”‚    â•‘    Zone    â•‘
    â”€â”€â”€â”€â”€â”´â”€â”€â”€ ğŸ“¡ â”€â”€â”´â”€â”€â”€â”€â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚   RSU  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           Junction

    Detection Logic:
    1. Calculate distance: âˆš[(veh_x - rsu_x)Â² + (veh_y - rsu_y)Â²]
    2. If distance â‰¤ 300m AND vehicle is emergency type:
       â””â”€> DETECT!
    3. Create greenwave for detected vehicle


MULTI-JUNCTION COORDINATION
============================

    Scenario: Ambulance on long route

    t=10s: RSU1 detects
    ğŸš‘ â†’â†’â†’ [ğŸ“¡]â”€â”€â”€â”€â”€[  ]â”€â”€â”€â”€â”€[  ]
           J2      J3      J4
           ğŸŸ¢      âšª      âšª
           Active  Planned Planned

    t=15s: Ambulance at J2, RSU2 activates J3
    [  ]â”€â”€â”€â”€â”€ğŸš‘ â†’â†’â†’ [ğŸ“¡]â”€â”€â”€â”€â”€[  ]
     J2              J3      J4
     ğŸ”´              ğŸŸ¢      âšª
     Cleared        Active  Planned

    t=20s: Ambulance at J3, RSU3 activates J4
    [  ]â”€â”€â”€â”€â”€[  ]â”€â”€â”€â”€â”€ğŸš‘ â†’â†’â†’ [ğŸ“¡]
     J2      J3              J4
     ğŸ”´      ğŸ”´              ğŸŸ¢
     Cleared Cleared        Active

    Greenwave propagates forward!


REWARD STRUCTURE SUMMARY
========================

    Normal Traffic Rewards:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Metric              â”‚ Reward   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Good flow           â”‚ +5 to +10â”‚
    â”‚ Moderate flow       â”‚ 0 to +5  â”‚
    â”‚ Congestion          â”‚ -5 to -20â”‚
    â”‚ Long waits          â”‚ -50      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Emergency Vehicle Rewards:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Metric              â”‚ Reward   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Moving fast (>10m/s)â”‚ +200 âœ“âœ“âœ“â”‚
    â”‚ Moving (>5m/s)      â”‚ +100 âœ“âœ“ â”‚
    â”‚ Slow/stopped        â”‚ -150 âœ—âœ—âœ—â”‚
    â”‚ Waiting >5s         â”‚ -100 âœ—âœ— â”‚
    â”‚ Greenwave active    â”‚ +50  âœ“  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Combined Best Case:
    Emergency moving fast + greenwave + good flow
    = +200 + 50 + 5 = +255 reward

    Combined Worst Case:
    Emergency stopped + waiting + congestion
    = -150 - 100 - 20 = -270 reward

    Learning gradient: 525 points difference!
    â†’ Very strong teaching signal


SYSTEM ARCHITECTURE
===================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            RL Training Loop                   â”‚
    â”‚                                               â”‚
    â”‚  1. Observe State                             â”‚
    â”‚     â”œâ”€ Vehicle positions & speeds             â”‚
    â”‚     â”œâ”€ Traffic light states                   â”‚
    â”‚     â””â”€ Emergency vehicle locations (NEW)      â”‚
    â”‚                                               â”‚
    â”‚  2. Emergency Check (NEW)                     â”‚
    â”‚     â”œâ”€ RSU detection                          â”‚
    â”‚     â”œâ”€ Greenwave creation                     â”‚
    â”‚     â””â”€ Priority override                      â”‚
    â”‚                                               â”‚
    â”‚  3. RL Agent Action                           â”‚
    â”‚     â””â”€ Select traffic light phases            â”‚
    â”‚                                               â”‚
    â”‚  4. Apply Actions                             â”‚
    â”‚     â”œâ”€ Set traffic lights                     â”‚
    â”‚     â””â”€ Maintain greenwave if active           â”‚
    â”‚                                               â”‚
    â”‚  5. Simulate                                  â”‚
    â”‚     â””â”€ SUMO advances 1 second                 â”‚
    â”‚                                               â”‚
    â”‚  6. Compute Reward (ENHANCED)                 â”‚
    â”‚     â”œâ”€ Base traffic rewards (Ã—0.3 if emerg)   â”‚
    â”‚     â”œâ”€ Emergency rewards (PRIORITY)           â”‚
    â”‚     â””â”€ Queue penalties (Ã—0.5 if emerg)        â”‚
    â”‚                                               â”‚
    â”‚  7. Learn                                     â”‚
    â”‚     â””â”€ Update policy with reward              â”‚
    â”‚                                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


KEY METRICS TO MONITOR
======================

    Console Output:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸš¨ Emergency vehicle detected: emergency_1 â”‚
    â”‚    by RSU_J2                               â”‚
    â”‚ ğŸŸ¢ Greenwave created: ['J2', 'J3']         â”‚
    â”‚ ğŸŸ¢ Greenwave: J2 set to phase 2            â”‚
    â”‚ âœ“ Emergency vehicle completed route        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Metrics Dictionary:
    {
      'active_emergencies': 1,      â† Current count
      'successful_greenwaves': 3,   â† Total created
      'emergency_detections': 5,    â† Total RSU detections
      'completed_vehicles': 127,    â† Vehicles finished
      'episode_reward': +1847.3     â† Cumulative reward
    }


SUCCESS INDICATORS
==================

    System is working correctly if you see:

    âœ… Emergency vehicles detected by RSUs
    âœ… Greenwave messages in console
    âœ… Traffic lights turning green ahead of ambulances
    âœ… High positive rewards when emergencies pass smoothly
    âœ… No crashes when vehicles complete short routes
    âœ… 'completed_vehicles' count increasing
    âœ… Emergency vehicles maintaining high speed
    âœ… Low emergency waiting times

    Problems indicators:

    âŒ No detection messages (check vehicle types)
    âŒ Emergency vehicles stopping at red lights
    âŒ Crashes when vehicles disappear
    âŒ Low/negative rewards during emergency passage
    âŒ Long emergency waiting times
```
